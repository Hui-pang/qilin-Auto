import{_ as z,r as m,K as F,m as L,c as w,j as c,a,w as l,n as g,p as q,i as R,q as G,E as H,s as J,k as n,u as Q,o as y,t as W,v as E,x as X,y as Y,h as u,z as Z,A as ee,C as K,b as ae,e as te,f as le}from"./index-CWseees8.js";import{a as _}from"./index-D4aPKAAE.js";/* empty css              *//* empty css                 *//* empty css                *//* empty css               */const oe={class:"automation-container"},se={class:"title-container"},ne={class:"title-buttons"},re={class:"card-actions"},de={key:1,class:"card-message"},ie={class:"dialog-footer"},ce={__name:"taosync",setup(ue){const V=Q(),{isDark:h,toggleTheme:x}=q(),d=m(!1),r=m({}),p=m(!1),f=m(""),o=m({address:"",apiKey:""}),T=F(()=>Object.values(r.value)),I=async()=>{try{const t=await _.get("/api/taosync");r.value=t.data}catch(t){n.error("获取配置失败"),console.error("获取配置失败:",t)}},D=async()=>{if(!o.value.address||!o.value.apiKey){n.warning("请填写完整信息");return}try{const t=await _.post("/api/taosync",o.value);r.value[t.data.id]=t.data,d.value=!1,o.value.address="",o.value.apiKey="",n.success("创建成功")}catch(t){n.error("创建配置失败"),console.error("创建配置失败:",t)}},j=async()=>{const t=Object.keys(r.value)[0];try{await _.delete(`/api/taosync/${t}`),delete r.value[t],n.success("删除成功")}catch(e){n.error("删除失败"),console.error("删除失败:",e)}};L(()=>{I()});const A=()=>{localStorage.removeItem("token"),localStorage.removeItem("expiresAt"),V.push("/login")},B=()=>{if(Object.keys(r.value).length>0){n.warning("已存在配置，不能创建更多");return}p.value=!1,o.value={address:"",apiKey:""},d.value=!0},M=t=>{p.value=!0,f.value=t.id,o.value={address:t.address,apiKey:t.apiKey},d.value=!0},O=async()=>{if(!o.value.address||!o.value.apiKey){n.warning("请填写完整信息");return}try{const t=await _.put(`/api/taosync/${f.value}`,o.value);r.value[f.value]=t.data,d.value=!1,n.success("更新成功")}catch(t){n.error("更新配置失败"),console.error("更新配置失败:",t)}};return(t,e)=>{const k=W,i=R,S=G,v=ee,$=Z,U=H,b=le,C=te,N=ae,P=J;return y(),w("div",oe,[c("div",se,[e[5]||(e[5]=c("h1",{class:"section-title"},"taosync设置",-1)),c("div",ne,[a(i,{type:"info",circle:"",onClick:g(x)},{default:l(()=>[a(k,null,{default:l(()=>[(y(),E(X(g(h)?"Sunny":"Moon")))]),_:1})]),_:1},8,["onClick"]),a(i,{type:"danger",circle:"",onClick:A},{default:l(()=>[a(k,null,{default:l(()=>[a(g(Y))]),_:1})]),_:1})])]),a(S),e[11]||(e[11]=c("h2",{class:"subsection-title"},"设置参数",-1)),a(U,{class:"content-card"},{default:l(()=>[c("div",re,[a(i,{type:"primary",onClick:B},{default:l(()=>e[6]||(e[6]=[u("创建")])),_:1}),a(i,{type:"danger",disabled:Object.keys(r.value).length===0,onClick:j},{default:l(()=>e[7]||(e[7]=[u("删除")])),_:1},8,["disabled"])]),Object.keys(r.value).length>0?(y(),E($,{key:0,data:T.value,style:{width:"100%"}},{default:l(()=>[a(v,{prop:"createTime",label:"创建时间",width:"180"},{default:l(s=>[u(K(new Date(s.row.createTime).toLocaleString()),1)]),_:1}),a(v,{prop:"address",label:"taosync地址"}),a(v,{prop:"apiKey",label:"API Key"}),a(v,{label:"操作",width:"120"},{default:l(s=>[a(i,{type:"success",size:"small",onClick:pe=>M(s.row)},{default:l(()=>e[8]||(e[8]=[u("编辑")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(y(),w("div",de,e[9]||(e[9]=[c("span",{class:"message-text"},"暂无配置，请点击创建按钮添加",-1)])))]),_:1}),a(P,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=s=>d.value=s),title:p.value?"编辑Taosync配置":"创建Taosync配置",width:"30%","close-on-click-modal":!1},{footer:l(()=>[c("span",ie,[a(i,{onClick:e[2]||(e[2]=s=>d.value=!1)},{default:l(()=>e[10]||(e[10]=[u("取消")])),_:1}),a(i,{type:"primary",onClick:e[3]||(e[3]=s=>p.value?O():D())},{default:l(()=>[u(K(p.value?"保存":"创建"),1)]),_:1})])]),default:l(()=>[a(N,{model:o.value,"label-width":"120px"},{default:l(()=>[a(C,{label:"Taosync地址："},{default:l(()=>[a(b,{modelValue:o.value.address,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.address=s),placeholder:"请输入Taosync地址"},null,8,["modelValue"])]),_:1}),a(C,{label:"API Key："},{default:l(()=>[a(b,{modelValue:o.value.apiKey,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.apiKey=s),placeholder:"请输入API Key"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ke=z(ce,[["__scopeId","data-v-797ac82c"]]);export{ke as default};
