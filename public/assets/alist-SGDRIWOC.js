import{_ as F,r as v,K as N,m as z,c as K,j as u,a as l,w as a,n as k,p as L,i as q,q as R,E as G,s as H,k as d,u as J,o as g,t as Q,v as A,x as W,y as X,h as p,z as Y,A as Z,C as ee,b as le,e as ae,f as te}from"./index-CWseees8.js";import{a as b}from"./index-D4aPKAAE.js";/* empty css              *//* empty css                 *//* empty css                *//* empty css               */const oe={class:"automation-container"},se={class:"title-container"},ne={class:"title-buttons"},de={class:"card-actions"},ie={key:1,class:"card-message"},re={class:"dialog-footer"},ue={class:"dialog-footer"},pe={__name:"alist",setup(ce){const E=J(),{isDark:x,toggleTheme:I}=L(),c=v(!1),m=v(!1),i=v({}),n=v({address:"",apiKey:""}),s=v({id:"",address:"",apiKey:""}),D=N(()=>Object.values(i.value)),T=async()=>{try{const t=await b.get("/api/alist");i.value=t.data}catch(t){d.error("获取配置失败"),console.error("获取配置失败:",t)}},U=async()=>{if(!n.value.address||!n.value.apiKey){d.warning("请填写完整信息");return}try{const t=await b.post("/api/alist",n.value);i.value[t.data.id]=t.data,c.value=!1,n.value.address="",n.value.apiKey="",d.success("创建成功")}catch(t){d.error("创建配置失败"),console.error("创建配置失败:",t)}},j=async()=>{const t=Object.keys(i.value)[0];try{await b.delete(`/api/alist/${t}`),delete i.value[t],d.success("删除成功")}catch(e){d.error("删除失败"),console.error("删除失败:",e)}};z(()=>{T()});const B=()=>{localStorage.removeItem("token"),localStorage.removeItem("expiresAt"),E.push("/login")},M=()=>{if(Object.keys(i.value).length>0){d.warning("已存在配置，不能创建更多");return}c.value=!0},O=t=>{s.value={...t},m.value=!0},P=async()=>{if(!s.value.address||!s.value.apiKey){d.warning("请填写完整信息");return}try{const t=await b.put(`/api/alist/${s.value.id}`,{address:s.value.address,apiKey:s.value.apiKey});i.value[s.value.id]=t.data,m.value=!1,d.success("更新成功")}catch(t){d.error("更新配置失败"),console.error("更新配置失败:",t)}};return(t,e)=>{const V=Q,r=q,S=R,f=Z,$=Y,h=G,_=te,y=ae,w=le,C=H;return g(),K("div",oe,[u("div",se,[e[8]||(e[8]=u("h1",{class:"section-title"},"Alist设置",-1)),u("div",ne,[l(r,{type:"info",circle:"",onClick:k(I)},{default:a(()=>[l(V,null,{default:a(()=>[(g(),A(W(k(x)?"Sunny":"Moon")))]),_:1})]),_:1},8,["onClick"]),l(r,{type:"danger",circle:"",onClick:B},{default:a(()=>[l(V,null,{default:a(()=>[l(k(X))]),_:1})]),_:1})])]),l(S),e[17]||(e[17]=u("h2",{class:"subsection-title"},"设置参数",-1)),l(h,{class:"content-card"},{default:a(()=>[u("div",de,[l(r,{type:"primary",onClick:M},{default:a(()=>e[9]||(e[9]=[p("创建")])),_:1}),l(r,{type:"danger",disabled:Object.keys(i.value).length===0,onClick:j},{default:a(()=>e[10]||(e[10]=[p("删除")])),_:1},8,["disabled"])]),Object.keys(i.value).length>0?(g(),A($,{key:0,data:D.value,style:{width:"100%"}},{default:a(()=>[l(f,{prop:"createTime",label:"创建时间",width:"180"},{default:a(o=>[p(ee(new Date(o.row.createTime).toLocaleString()),1)]),_:1}),l(f,{prop:"address",label:"Alist地址"}),l(f,{prop:"apiKey",label:"API Key"}),l(f,{label:"操作",width:"120"},{default:a(o=>[l(r,{size:"small",type:"success",onClick:me=>O(o.row)},{default:a(()=>e[11]||(e[11]=[p(" 编辑 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(g(),K("div",ie,e[12]||(e[12]=[u("span",{class:"message-text"},"暂无配置，请点击创建按钮添加",-1)])))]),_:1}),l(C,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),title:"创建Alist配置",width:"30%","close-on-click-modal":!1},{footer:a(()=>[u("span",re,[l(r,{onClick:e[2]||(e[2]=o=>c.value=!1)},{default:a(()=>e[13]||(e[13]=[p("取消")])),_:1}),l(r,{type:"primary",onClick:U},{default:a(()=>e[14]||(e[14]=[p("创建")])),_:1})])]),default:a(()=>[l(w,{model:n.value,"label-width":"120px"},{default:a(()=>[l(y,{label:"Alist地址："},{default:a(()=>[l(_,{modelValue:n.value.address,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.address=o),placeholder:"请输入Alist地址"},null,8,["modelValue"])]),_:1}),l(y,{label:"API Key："},{default:a(()=>[l(_,{modelValue:n.value.apiKey,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.apiKey=o),placeholder:"请输入API Key"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(C,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=o=>m.value=o),title:"编辑Alist配置",width:"30%","close-on-click-modal":!1},{footer:a(()=>[u("span",ue,[l(r,{onClick:e[6]||(e[6]=o=>m.value=!1)},{default:a(()=>e[15]||(e[15]=[p("取消")])),_:1}),l(r,{type:"primary",onClick:P},{default:a(()=>e[16]||(e[16]=[p("确定")])),_:1})])]),default:a(()=>[l(w,{model:s.value,"label-width":"120px"},{default:a(()=>[l(y,{label:"Alist地址："},{default:a(()=>[l(_,{modelValue:s.value.address,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.address=o),placeholder:"请输入Alist地址"},null,8,["modelValue"])]),_:1}),l(y,{label:"API Key："},{default:a(()=>[l(_,{modelValue:s.value.apiKey,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.apiKey=o),placeholder:"请输入API Key"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ke=F(pe,[["__scopeId","data-v-8ed80c84"]]);export{ke as default};
