import{_ as E,r as h,L as U,c as S,j as l,a as o,w as s,n as c,p as x,i as I,q as B,E as D,u as T,o as w,t as q,v as M,x as N,y as j,b as R,e as A,f as F,h as f,k as _}from"./index-CWseees8.js";/* empty css              *//* empty css                *//* empty css               */const O={class:"automation-container"},J={class:"title-container"},L={class:"title-buttons"},z={class:"button-group"},G={__name:"UserSettingsView",setup(H){const p=T(),m=h(null),{isDark:g,toggleTheme:v}=x(),t=U({newUsername:"",newPassword:"",confirmPassword:""}),b={newUsername:[{required:!0,message:"请输入新用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应在3到20个字符之间",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(a,e,r)=>{e===""?r(new Error("请再次输入新密码")):e!==t.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},P=async()=>{if(m.value)try{await m.value.validate();const a=localStorage.getItem("username")||"admin",e=await fetch("/api/auth/update-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,newUsername:t.newUsername,newPassword:t.newPassword})}),r=await e.json();if(!e.ok)throw new Error(r.error);localStorage.setItem("username",r.username),_.success("设置已更新"),p.push("/")}catch(a){console.error("更新设置失败:",a),_.error(a.message||"更新设置失败")}},y=()=>{localStorage.removeItem("token"),localStorage.removeItem("expiresAt"),p.push("/login")};return(a,e)=>{const r=q,i=I,k=B,u=F,d=A,V=R,C=D;return w(),S("div",O,[l("div",J,[e[3]||(e[3]=l("h1",{class:"section-title"},"用户设置",-1)),l("div",L,[o(i,{type:"info",circle:"",onClick:c(v)},{default:s(()=>[o(r,null,{default:s(()=>[(w(),M(N(c(g)?"Sunny":"Moon")))]),_:1})]),_:1},8,["onClick"]),o(i,{type:"danger",circle:"",onClick:y},{default:s(()=>[o(r,null,{default:s(()=>[o(c(j))]),_:1})]),_:1})])]),o(k),e[6]||(e[6]=l("h2",{class:"subsection-title"},"用户名和密码",-1)),o(C,{class:"content-card"},{default:s(()=>[o(V,{model:t,rules:b,ref_key:"formRef",ref:m,"label-width":"120px"},{default:s(()=>[o(d,{label:"新用户名",prop:"newUsername"},{default:s(()=>[o(u,{modelValue:t.newUsername,"onUpdate:modelValue":e[0]||(e[0]=n=>t.newUsername=n),placeholder:"请输入新用户名"},null,8,["modelValue"])]),_:1}),o(d,{label:"密码",prop:"newPassword"},{default:s(()=>[o(u,{modelValue:t.newPassword,"onUpdate:modelValue":e[1]||(e[1]=n=>t.newPassword=n),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),o(d,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(u,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>t.confirmPassword=n),type:"password",placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[l("div",z,[o(i,{type:"primary",onClick:P},{default:s(()=>e[4]||(e[4]=[f("确认")])),_:1}),o(i,{onClick:a.handleCancel},{default:s(()=>e[5]||(e[5]=[f("取消")])),_:1},8,["onClick"])])]),_:1})]),_:1},8,["model"])]),_:1})])}}},Z=E(G,[["__scopeId","data-v-40e01090"]]);export{Z as default};
